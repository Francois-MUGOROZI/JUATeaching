@inherits LayoutComponentBase
@using MudBlazor
@inject NavigationManager Navigation

@* Required *@
<MudThemeProvider @bind-IsDarkMode="@_isDarkMode" Theme="_theme"/>
<MudPopoverProvider />

@* Needed for dialogs *@
<MudDialogProvider />
@* Needed for snackbars *@
<MudSnackbarProvider />

<MudLayout>
    <MudAppBar Elevation="1">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@((e) => DrawerToggle())" />
        <MudText Typo="Typo.h6" Class="ml-2">CRM Demo</MudText>

        <MudSpacer />
        <MudIconButton Icon="@(_isDarkMode ? Icons.Material.Filled.LightMode : Icons.Material.Filled.DarkMode)" 
                       Color="Color.Inherit" 
                       OnClick="ToggleTheme"
                       title="@(_isDarkMode ? "Switch to Light Mode" : "Switch to Dark Mode")" />
        <MudIconButton Icon="@Icons.Material.Filled.Logout" 
                       Color="Color.Inherit" 
                       OnClick="HandleLogout"
                       title="Logout" />
    </MudAppBar>
    <MudDrawer @bind-Open="@_drawerOpen" 
               Elevation="1"
               Variant="@DrawerVariant.Mini"
               OpenMiniOnHover="true"
               ClipMode="@DrawerClipMode.Always">
        <NavMenu />
    </MudDrawer>
    <MudMainContent>
        @Body
    </MudMainContent>
</MudLayout>

@code {
    bool _drawerOpen = true;

    private MudTheme _theme = new MudTheme()
    {
        PaletteLight = new PaletteLight()
        {
            Primary = Colors.Blue.Darken2,           // Deep blue for primary actions
            Secondary = Colors.Teal.Darken1,         // Teal for secondary actions
            Tertiary = Colors.Orange.Accent2,         // Orange for accents
            AppbarBackground = Colors.Blue.Darken3,   // Dark blue appbar
            Background = Colors.Gray.Lighten5,       // Very light gray background
            Surface = Colors.Shades.White,            // White surface
            DrawerBackground = Colors.Shades.White,   // White drawer
            DrawerText = Colors.Shades.Black,         // Black text in drawer
            Success = Colors.Green.Darken1,           // Success green
            Warning = Colors.Orange.Darken1,          // Warning orange
            Error = Colors.Red.Darken1,                // Error red
            Info = Colors.Blue.Darken1,                // Info blue
            TextPrimary = Colors.Shades.Black,        // Primary text
            TextSecondary = Colors.Gray.Darken1,      // Secondary text
            Divider = Colors.Gray.Lighten1,          // Divider color
            DividerLight = Colors.Gray.Lighten2      // Light divider
        },
        PaletteDark = new PaletteDark()
        {
            Primary = Colors.Blue.Lighten1,          // Light blue for primary actions
            Secondary = Colors.Teal.Lighten1,        // Light teal for secondary
            Tertiary = Colors.Orange.Lighten1,       // Light orange for accents
            AppbarBackground = Colors.Gray.Darken4,   // Very dark gray appbar
            Background = Colors.Gray.Darken3,        // Dark gray background
            Surface = Colors.Gray.Darken2,            // Dark surface
            DrawerBackground = Colors.Gray.Darken3,  // Dark drawer
            DrawerText = Colors.Shades.White,        // White text in drawer
            Success = Colors.Green.Lighten1,         // Success green
            Warning = Colors.Orange.Lighten1,        // Warning orange
            Error = Colors.Red.Lighten1,              // Error red
            Info = Colors.Blue.Lighten1,              // Info blue
            TextPrimary = Colors.Shades.White,       // Primary text
            TextSecondary = Colors.Gray.Lighten1,     // Secondary text
            Divider = Colors.Gray.Darken1,           // Divider color
            DividerLight = Colors.Gray.Darken2       // Light divider
        },
        LayoutProperties = new LayoutProperties()
        {
            DefaultBorderRadius = "4px",
            DrawerWidthLeft = "260px",
            DrawerWidthRight = "300px",
            AppbarHeight = "64px"
        }
    };
    
    private bool _isDarkMode;

    void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
    }

    void ToggleTheme()
    {
        _isDarkMode = !_isDarkMode;
    }

    private void HandleLogout()
    {
        Navigation.NavigateTo("/account/logout", forceLoad: true);
    }
}