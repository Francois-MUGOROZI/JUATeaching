@using Application.DTO
@using System.ComponentModel.DataAnnotations
@using Microsoft.AspNetCore.Components.Forms

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">@Title</MudText>
    </TitleContent>
    <DialogContent>
        <EditForm Model="@Model" OnValidSubmit="OnValidSubmit">
            <DataAnnotationsValidator />
            <ValidationSummary Class="mb-3" />
            
            <MudTextField @bind-Value="Model.FirstName" 
                         Label="First Name" 
                         Required="true"
                         RequiredError="First Name is required"
                         Variant="Variant.Outlined"
                         Margin="Margin.Dense"
                         Class="mt-3" />
            
            <MudTextField @bind-Value="Model.LastName" 
                         Label="Last Name" 
                         Required="true"
                         RequiredError="Last Name is required"
                         Variant="Variant.Outlined"
                         Margin="Margin.Dense"
                         Class="mt-3" />
            
            @if (IsCreate)
            {
                <MudTextField @bind-Value="Model.Email" 
                             Label="Email" 
                             Required="true"
                             RequiredError="Email is required"
                             Variant="Variant.Outlined"
                             Margin="Margin.Dense"
                             InputType="InputType.Email"
                             Class="mt-3" />
            }
            
            <MudTextField @bind-Value="Model.PhoneNumber" 
                         Label="Phone Number" 
                         Variant="Variant.Outlined"
                         Margin="Margin.Dense"
                         Class="mt-3" />
        </EditForm>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Cancel</MudButton>
        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="OnValidSubmit">@SubmitText</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] IMudDialogInstance MudDialog { get; set; } = default!;
    
    [Parameter] public bool IsCreate { get; set; } = true;
    [Parameter] public CustomerCreateDTO? CreateModel { get; set; }
    [Parameter] public CustomerUpdateDTO? UpdateModel { get; set; }

    private CustomerCreateDTO Model { get; set; } = new();
    private CustomerUpdateDTO? UpdateModelInternal { get; set; }

    private string Title => IsCreate ? "Create Customer" : "Edit Customer";
    private string SubmitText => IsCreate ? "Create" : "Save";

    protected override void OnInitialized()
    {
        if (IsCreate)
        {
            Model = CreateModel ?? new CustomerCreateDTO();
        }
        else
        {
            UpdateModelInternal = UpdateModel ?? new CustomerUpdateDTO();
            Model = new CustomerCreateDTO
            {
                FirstName = UpdateModelInternal.FirstName ?? string.Empty,
                LastName = UpdateModelInternal.LastName ?? string.Empty,
                Email = string.Empty,
                PhoneNumber = UpdateModelInternal.PhoneNumber ?? string.Empty
            };
        }
    }

    private void Cancel()
    {
        MudDialog.Cancel();
    }

    private void OnValidSubmit()
    {
        if (IsCreate)
        {
            MudDialog.Close(DialogResult.Ok(Model));
        }
        else
        {
            var updateDto = new CustomerUpdateDTO
            {
                FirstName = Model.FirstName,
                LastName = Model.LastName,
                PhoneNumber = Model.PhoneNumber
            };
            MudDialog.Close(DialogResult.Ok(updateDto));
        }
    }
}
